<!-- index.html -->
<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b1220" />
  <title>Tracker Scommesse</title>
  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="topbarInner">
      <div class="brand">
        <div class="brandTitle">Tracker Scommesse</div>
        <div class="brandSub">Offline ‚Ä¢ LocalStorage</div>
      </div>

      <div class="totals">
        <div class="pill">
          <div class="pillLabel">Bankroll iniziale</div>
          <div id="budgetStart" class="pillValue">‚Ç¨ 0,00</div>
        </div>
        <div class="pill">
          <div class="pillLabel">Disponibile totale</div>
          <div id="budgetNow" class="pillValue">‚Ç¨ 0,00</div>
        </div>
      </div>
    </div>

    <div class="miniBooks">
      <div id="miniBooksRow" class="miniBooksRow"></div>
      <button class="ghostBtn" id="btnGoBooks" title="Vai a Bookmakers">Gestisci Bookmakers ‚Üí</button>
    </div>
  </header>

  <main class="main">
    <!-- Aggiungi -->
    <section id="page-add" class="page show">

      <div class="card">
        <div class="cardTitle">Bankroll base</div>
        <div class="row gap wrap">
          <label class="field inline grow">
            <span>Bankroll iniziale (base)</span>
            <input id="inpBudget" type="number" inputmode="decimal" step="0.01" placeholder="Es. 500" />
          </label>
          <button id="btnSetBudget" class="btn">Salva bankroll</button>
        </div>
        <div class="hint">
          La <b>puntata %</b> √® sempre calcolata su questo bankroll base (non sul disponibile).
          I budget dei bookmakers si gestiscono nella pagina <b>Bookmakers</b>.
        </div>
      </div>

      <div class="card">
        <div class="cardTitle">Aggiungi scommessa</div>

        <div class="formGrid">
          <label class="field">
            <span>Data</span>
            <input id="fDate" type="date" />
          </label>

          <label class="field">
            <span>Bookmaker</span>
            <select id="fBook"></select>
          </label>

          <label class="field">
            <span>Tipster</span>
            <input id="fTipster" type="text" placeholder="Es. Mario" />
          </label>

          <label class="field fieldWide">
            <span>Descrizione</span>
            <input id="fDesc" type="text" placeholder="Es. Over 2.5, Tennis, ecc." />
          </label>

          <label class="field">
            <span>Quota</span>
            <input id="fOdds" type="number" inputmode="decimal" step="0.01" placeholder="1.50" />
          </label>

          <label class="field">
            <span>Puntata % (su base)</span>
            <input id="fStakePct" type="number" inputmode="decimal" step="0.01" placeholder="2" />
          </label>

          <label class="field">
            <span>Puntata ‚Ç¨ (manuale)</span>
            <input id="fStakeAmt" type="number" inputmode="decimal" step="0.01" placeholder="10" />
          </label>

          <label class="field">
            <span>Esito</span>
            <select id="fOutcome">
              <option>In corso</option>
              <option>Vinta</option>
              <option>Persa</option>
              <option>Void</option>
            </select>
          </label>
        </div>

        <div class="row between gap">
          <div class="hint" id="stakePreview">Puntata calcolata: ‚Ç¨ 0,00</div>
          <button id="btnAdd" class="btn primary">Aggiungi</button>
        </div>
      </div>

      <div class="card">
        <div class="cardTitle">Backup & Import</div>
        <div class="row gap wrap">
          <button id="btnBackup" class="btn">Backup JSON</button>
          <button id="btnImport" class="btn">Import JSON</button>
          <input id="fileImport" type="file" accept="application/json" hidden />
          <button id="btnReset" class="btn danger">Reset totale</button>
        </div>
        <div class="hint">Import: puoi <b>Sostituire</b> o <b>Unire</b>. Migrazione automatica inclusa.</div>
      </div>
    </section>

    <!-- Scommesse -->
    <section id="page-bets" class="page">
      <div class="card">
        <div class="cardTitle">Scommesse</div>
        <div class="row gap wrap">
          <label class="field inline">
            <span>Filtro</span>
            <select id="filterOutcome">
              <option>Tutte</option>
              <option>In corso</option>
              <option>Vinta</option>
              <option>Persa</option>
              <option>Void</option>
            </select>
          </label>

          <label class="field inline grow">
            <span>Cerca</span>
            <input id="search" type="text" placeholder="Tipster, descrizione o bookmaker..." />
          </label>
        </div>
      </div>

      <div class="card">
        <div class="row between">
          <div class="cardTitle">In corso</div>
          <div class="hint">Lo stake scala solo dal bookmaker selezionato</div>
        </div>
        <div id="listOpen"></div>
      </div>

      <div class="card">
        <div class="row between">
          <div class="cardTitle">Chiuse</div>
          <div class="hint">Grafici e ROI si muovono solo sulle chiuse</div>
        </div>
        <div id="listClosed"></div>
      </div>
    </section>

    <!-- Giorni -->
    <section id="page-days" class="page">
      <div class="card">
        <div class="cardTitle">Giorni</div>
        <div class="row gap wrap">
          <label class="field inline">
            <span>Mostra</span>
            <select id="daysFilter">
              <option value="all">Tutte</option>
              <option value="closed">Solo chiuse</option>
              <option value="open">Solo in corso</option>
            </select>
          </label>

          <label class="field inline grow">
            <span>Cerca</span>
            <input id="daysSearch" type="text" placeholder="Tipster, descrizione o bookmaker..." />
          </label>
        </div>
      </div>

      <div class="card">
        <div class="row between">
          <div class="cardTitle">Saldo cumulativo (chiuse)</div>
          <div class="hint">Per giorno</div>
        </div>
        <div class="chartWrap">
          <canvas id="cDays" class="chart" height="240"></canvas>
        </div>
      </div>

      <div class="card">
        <div class="row between">
          <div class="cardTitle">Riepilogo per giorno</div>
          <div class="hint">Tocca un giorno per aprire</div>
        </div>
        <div id="daysList"></div>
      </div>
    </section>

    <!-- Statistiche -->
    <section id="page-stats" class="page">
      <div class="card">
        <div class="cardTitle">Statistiche</div>

        <div class="statsGrid">
          <div class="stat">
            <div class="statLabel">Totali</div>
            <div id="sTotal" class="statValue">0</div>
          </div>
          <div class="stat">
            <div class="statLabel">Chiuse</div>
            <div id="sClosed" class="statValue">0</div>
          </div>
          <div class="stat">
            <div class="statLabel">WR</div>
            <div id="sWR" class="statValue">0%</div>
          </div>
          <div class="stat">
            <div class="statLabel">Puntato (chiuse)</div>
            <div id="sStaked" class="statValue">‚Ç¨ 0,00</div>
          </div>
          <div class="stat">
            <div class="statLabel">Profitto (chiuse)</div>
            <div id="sProfit" class="statValue">‚Ç¨ 0,00</div>
          </div>
          <div class="stat">
            <div class="statLabel">ROI su base</div>
            <div id="sROI" class="statValue">0%</div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="row between">
          <div class="cardTitle">Bankroll (solo chiuse)</div>
          <div class="hint">Parte dal bankroll iniziale</div>
        </div>
        <div class="chartWrap">
          <canvas id="cBank" class="chart" height="240"></canvas>
        </div>
      </div>

      <div class="grid2">
        <div class="card">
          <div class="cardTitle">Esiti (chiuse)</div>
          <div class="chartWrap">
            <canvas id="cPie" class="chart" height="240"></canvas>
          </div>
        </div>
        <div class="card">
          <div class="row between">
            <div class="cardTitle">Top Tipster (profit)</div>
            <button id="btnTipRefresh" class="btn mini">Aggiorna</button>
          </div>
          <div class="chartWrap">
            <canvas id="cTip" class="chart" height="240"></canvas>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="row between">
          <div class="cardTitle">Tipster</div>
          <div class="hint">Solo chiuse</div>
        </div>
        <div id="tipList"></div>
      </div>
    </section>

    <!-- Bookmakers -->
    <section id="page-books" class="page">
      <div class="card">
        <div class="row between">
          <div class="cardTitle">Bookmakers</div>
          <button id="btnBmEven" class="btn">Ripartisci equamente</button>
        </div>

        <div class="statsGrid" style="margin-top:12px">
          <div class="stat">
            <div class="statLabel">Totale iniziale</div>
            <div id="bmTotalStart" class="statValue">‚Ç¨ 0,00</div>
          </div>
          <div class="stat">
            <div class="statLabel">Totale disponibile</div>
            <div id="bmTotalAvail" class="statValue">‚Ç¨ 0,00</div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="row gap wrap">
          <label class="field inline grow">
            <span>Nome</span>
            <input id="bmName" type="text" placeholder="Es. Bet365" />
          </label>
          <label class="field inline">
            <span>Budget iniziale ‚Ç¨</span>
            <input id="bmStart" type="number" inputmode="decimal" step="0.01" placeholder="100" />
          </label>
          <button id="btnBmAdd" class="btn primary">Aggiungi</button>
        </div>

        <div class="hint">Puoi eliminare un bookmaker solo se non √® usato da nessuna bet.</div>
      </div>

      <div class="card">
        <div class="cardTitle">Elenco</div>
        <div id="booksList"></div>
      </div>
    </section>
  </main>

  <!-- Tabbar -->
  <nav class="tabbar">
    <button class="tab active" data-page="page-add">‚ûï<span>Aggiungi</span></button>
    <button class="tab" data-page="page-bets">üìã<span>Scommesse</span></button>
    <button class="tab" data-page="page-days">üìÜ<span>Giorni</span></button>
    <button class="tab" data-page="page-stats">üìà<span>Statistiche</span></button>
    <button class="tab" data-page="page-books">üè¶<span>Bookmakers</span></button>
  </nav>

  <!-- Modal edit -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="sheet">
      <div class="row between">
        <div class="sheetTitle">Modifica scommessa</div>
        <button id="btnClose" class="iconBtn" aria-label="Chiudi">‚úï</button>
      </div>

      <div class="formGrid">
        <label class="field">
          <span>Data</span>
          <input id="eDate" type="date" />
        </label>

        <label class="field">
          <span>Bookmaker</span>
          <select id="eBook"></select>
        </label>

        <label class="field">
          <span>Tipster</span>
          <input id="eTipster" type="text" />
        </label>

        <label class="field fieldWide">
          <span>Descrizione</span>
          <input id="eDesc" type="text" />
        </label>

        <label class="field">
          <span>Quota</span>
          <input id="eOdds" type="number" inputmode="decimal" step="0.01" />
        </label>

        <label class="field">
          <span>Puntata % (su base)</span>
          <input id="eStakePct" type="number" inputmode="decimal" step="0.01" />
        </label>

        <label class="field">
          <span>Puntata ‚Ç¨ (manuale)</span>
          <input id="eStakeAmt" type="number" inputmode="decimal" step="0.01" />
        </label>

        <label class="field">
          <span>Esito</span>
          <select id="eOutcome">
            <option>In corso</option>
            <option>Vinta</option>
            <option>Persa</option>
            <option>Void</option>
          </select>
        </label>
      </div>

      <div class="row between gap">
        <button id="btnDelete" class="btn danger">üóë Elimina</button>
        <button id="btnSave" class="btn primary">Salva</button>
      </div>

      <div class="hint" style="margin-top:10px">
        Nota: se il bookmaker non ha abbastanza disponibile, lo stake viene automaticamente limitato.
      </div>
    </div>
  </div>

  <script src="./app.js"></script>
</body>
</html>
